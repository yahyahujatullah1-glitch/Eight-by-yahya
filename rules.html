<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rules - Star City RP</title>
    <link rel="icon" href="https://i.ibb.co/3m8R27Q/1764065611411.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="menu-overlay" onclick="toggleMenu()"></div>
    <div class="side-menu" id="sideMenu">
        <div class="side-header"><span>MENU</span><i class="fa-solid fa-xmark close-btn" onclick="toggleMenu()"></i></div>
        <div class="side-links">
            <a href="index.html">Home</a>
            <a href="contact.html">Contact</a>
        </div>
    </div>

    <nav>
        <a href="index.html" class="logo-img-wrap"><img src="logo.png" alt="Logo" class="nav-logo"></a>
        <div class="nav-links desktop-only"><a href="index.html">Back to Home</a></div>
        <div class="menu-btn mobile-only" onclick="toggleMenu()"><i class="fa-solid fa-bars-staggered"></i></div>
    </nav>

    <div class="page-header-wrap"><h1 class="page-title">Rulebook</h1></div>

    <div class="rules-container">
        <aside class="rules-sidebar">
            <h3>Categories</h3>
            <div id="dynamic-tabs"><p>Loading...</p></div>
        </aside>
        <main class="rules-content" id="rules-content-area"><p>Select a category.</p></main>
    </div>

    <footer class="global-footer"><div class="disclaimer"><p>&copy; 2025 Star City RP.</p></div></footer>

    <script src="js/script.js"></script>
    <script type="module">
        import { supabase } from './js/supabase.js';
        // ... (Paste same script from previous rules.html response here for fetching rules) ...
        // OR Ensure you have the code that fetches rules from supabase here.
        
        document.addEventListener('DOMContentLoaded', async () => {
            const { data: categories } = await supabase.from('categories').select('*').order('order_index', { ascending: true });
            const { data: rules } = await supabase.from('rules').select('*');
            const tabContainer = document.getElementById('dynamic-tabs');
            tabContainer.innerHTML = "";

            if (categories && categories.length > 0) {
                categories.forEach((cat, index) => {
                    const btn = document.createElement('button');
                    btn.className = `rule-tab ${index === 0 ? 'active' : ''}`;
                    btn.innerText = cat.name;
                    btn.onclick = () => switchCategory(cat.slug, rules, cat.name, btn);
                    tabContainer.appendChild(btn);
                });
                renderCategory(categories[0].slug, rules, categories[0].name);
            }
        });

        function renderCategory(slug, allRules, title) {
            const container = document.getElementById('rules-content-area');
            const filtered = allRules.filter(r => r.category === slug);
            let html = `<h2 class="rule-head reveal active">${title}</h2>`;
            filtered.forEach(rule => { html += `<div class="rule-box reveal active"><h4>${rule.title}</h4><p>${rule.content}</p></div>`; });
            container.innerHTML = html;
        }

        function switchCategory(slug, allRules, title, btn) {
            document.querySelectorAll('.rule-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderCategory(slug, allRules, title);
            if(window.innerWidth < 768) document.getElementById('rules-content-area').scrollIntoView({behavior:'smooth'});
        }
    </script>
</body>
</html>
